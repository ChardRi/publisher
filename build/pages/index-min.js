/*! publisher - v1.0 2014-02-27 1:44:51 PM */ 
KISSY.add("publisher/mods/storage",function(){var a;if("undefined"==typeof window.localStorage){var a={},b="data-userdata",c=document,d=c.body,e=function(a,c,e,f){d.load(b),e=d.getAttribute(b)||"",f=RegExp("\\b"+a+"\\b,?","i");var g=f.test(e)?1:0;e=c?e.replace(f,""):g?e:""===e?a:e.split(",").concat(a).join(","),d.setAttribute(b,e),d.save(b)};d.addBehavior("#default#userData"),a.getItem=function(a){return d.load(a),d.getAttribute(a)},a.setItem=function(a,b){d.setAttribute(a,b),d.save(a),e(a)},a.removeItem=function(a){d.removeAttribute(a),d.save(a),e(a,1)},a.clear=function(){d.load(b);var a=d.getAttribute(b).split(","),c=a.length;if(""!==a[0]){for(var e=0;c>e;e++)d.removeAttribute(a[e]),d.save(a[e]);d.setAttribute(b,""),d.save(b)}}}else a=window.localStorage;return a}),KISSY.add("publisher/pages/index",function(a,b,c,d,e,f,g){function h(){h.superclass.constructor.apply(this,arguments),this._init()}{var i=b.all,j=a.NodeList;"placeholder"in document.createElement("input")}return h.ATTRS={node:{value:null},maxLen:{value:1500},placeholderText:{value:"\u8bf7\u8f93\u5165\u4f60\u7684\u5206\u4eab\uff0c1500\u5b57\u4ee5\u5185"},charType:{value:"cn"},timeInterval:{value:30},url:{value:null},callback:{value:null}},a.extend(h,a.Base,{_init:function(){var a=this;a.node=a.get("node"),a.node instanceof j||(a.node=i(a.node)),a.onList={},a.fireList={},a.render(),a.bindUI()},render:function(){var a=this,b='<div class="publisher-status"><dl class="publisher-tags"><dd class="publisher-tag">\u5206\u4eab</dd><dd class="publisher-tag">\u5f00\u4f1a</dd></dl><div class="publisher-fontcount"><em class="font-count">0</em>/{{maxLen}}</div></div><div class="publisher-textarea"><div class="tag-arrow"><span class="arrow-line arrow">\u25c6</span><span class="arrow-bg arrow">\u25c6</span></div><textarea class="publisher-content" placeholder="{{{placeholderText}}}" id="{{{textareaNode}}}"></textarea></div><div class="publisher-buttons"><button class="publisher-submit">\u53d1\u5e03</button></div>',c={maxLen:a.get("maxLen"),placeholderText:a.get("placeholderText"),textareaNode:a.get("textareaNode")},f=new d(b).render(c);i(f).appendTo(a.node),a.textareaNode=a.node.one(".publisher-content"),a.textareaWrap=a.node.one(".publisher-textarea"),a.submitButton=a.node.one(".publisher-submit"),a.fontCountNode=a.node.one(".font-count"),11==e.ie&&a.textareaNode.css("margin-top","6px")},bindUI:function(){var a=this,b="placeholder"in document.createElement("input");if(!b){var c='<label class="placeholder-text" style="color:#9a9a9a;font-family: Microsoft YaHei;position:absolute;left:12px;top:20px;top:18px\\0;*top:16px;" for="{{{textareaNode}}}">{{placeholderText}}</label>',e={textareaNode:a.get("textareaNode"),placeholderText:a.get("placeholderText")},h=new d(c).render(e);i(h).appendTo(a.textareaWrap),a.textareaNode.on("valuechange",function(){""===i(this).val()?i(".placeholder-text").show():i(".placeholder-text").hide()})}var j=a.get("maxLen");a.submitStatus=!1,a.textareaNode.on("valuechange",function(b){for(var c=0,d=(b.prevVal,b.newVal),e=0,f=d.length;f>e;e++)c+=d.charCodeAt(e)>255?2:1;a.submitStatus=f>0&&j>=f?!0:!1,"cn"===a.get("charType")?a.fontCountNode.html(parseInt(c/2)):"en"===a.get("charType")&&a.fontCountNode.html(parseInt(c))}),a.submitButton.on("click",function(){var b=a.get("timeInterval");if(a.submitStatus===!0)if("undefined"!=typeof a.fireList.submit)a.fire("submit");else{var c=a.textareaNode.val(),d=(new Date).getTime(),e=g.getItem(a.get("node")+"lastPubVal"),h=g.getItem(a.get("node")+"lastPubTime");if(""===e||/\d/.test(h)&&d-h>1e3*b||e!=c){var i=f({type:"post",url:a.get("url"),dataType:"json",data:{value:c}});i.then(function(b){return g.setItem(a.get("node")+"lastPubTime",d),g.setItem(a.get("node")+"lastPubVal",c),b}).then(function(b){a.get("callback")(b[0])})}else a._error()}else a._error()})},on:function(a,b){this.onList[a]&&b(),this.fireList[a]=b},fire:function(a){this.onList[a]=!0,this.fireList[a]&&this.fireList[a]()},reset:function(){this.textareaNode.val("")},val:function(){return this.textareaNode.val()},fontCount:function(){return this.fontCountNode.html()},_error:function(){var a=this,b=a.node.one(".arrow-bg");e.ie<10?(a.textareaNode.animate({background:"#F5A9A9"},{duration:.4}).animate({background:"#FFF"},{duration:.2}).animate({background:"#F5A9A9"},{duration:.4}).animate({background:"#FFF"},{duration:.2}),b.animate({color:"#F5A9A9"},{duration:.4}).animate({color:"#FFF"},{duration:.2}).animate({color:"#F5A9A9"},{duration:.4}).animate({color:"#FFF"},{duration:.2})):(a.textareaNode.addClass("content-error"),b.addClass("tag-error"),setTimeout(function(){a.textareaNode.removeClass("content-error"),b.removeClass("tag-error")},1e3))}}),h},{requires:["node","base","xtemplate","ua","io","../mods/storage"]});